<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2862px" preserveAspectRatio="none" style="width:1217px;height:2862px;" version="1.1" viewBox="0 0 1217 2862" width="1217px" zoomAndPan="magnify" ml-update="aware"><defs><filter height="300%" id="fm6ihpdvodsfn" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fm6ihpdvodsfn)" height="376.6563" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="939" x="10" y="914.3438"/><rect fill="#FFFFFF" filter="url(#fm6ihpdvodsfn)" height="370.3906" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="897" x="52" y="1305"/><rect fill="#FFFFFF" filter="url(#fm6ihpdvodsfn)" height="200.1953" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="931" x="28" y="1983.5859"/><rect fill="#FFFFFF" filter="url(#fm6ihpdvodsfn)" height="491.3906" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="694" x="506" y="2197.7813"/><rect fill="#FFFFFF" filter="url(#fm6ihpdvodsfn)" height="46.2656" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="434.5" x="440" y="2703.1719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="475" x2="475" y1="53.2969" y2="2805.5703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="841.5" x2="841.5" y1="53.2969" y2="2805.5703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1113" x2="1113" y1="53.2969" y2="2805.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="450" y="49.9951">Server</text><ellipse cx="475" cy="21" fill="#FEFECE" filter="url(#fm6ihpdvodsfn)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="463" x2="487" y1="35" y2="35"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="450" y="2817.5654">Server</text><ellipse cx="475" cy="2836.8672" fill="#FEFECE" filter="url(#fm6ihpdvodsfn)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="463" x2="487" y1="2850.8672" y2="2850.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="819.5" y="49.9951">Client</text><ellipse cx="842" cy="21" fill="#FEFECE" filter="url(#fm6ihpdvodsfn)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="830" x2="854" y1="35" y2="35"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="819.5" y="2817.5654">Client</text><ellipse cx="842" cy="2836.8672" fill="#FEFECE" filter="url(#fm6ihpdvodsfn)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="830" x2="854" y1="2850.8672" y2="2850.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="1036" y="49.9951">Ubuntu Archive Mirror</text><ellipse cx="1113" cy="21" fill="#FEFECE" filter="url(#fm6ihpdvodsfn)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1101" x2="1125" y1="35" y2="35"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="1036" y="2817.5654">Ubuntu Archive Mirror</text><ellipse cx="1113" cy="2836.8672" fill="#FEFECE" filter="url(#fm6ihpdvodsfn)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1101" x2="1125" y1="2850.8672" y2="2850.8672"/><rect fill="#EEEEEE" filter="url(#fm6ihpdvodsfn)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1210" x="0" y="83.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1210" y1="83.8633" y2="83.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1210" y1="86.8633" y2="86.8633"/><rect fill="#EEEEEE" filter="url(#fm6ihpdvodsfn)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="305" x="452.5" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="286" x="458.5" y="89.3638">第 1 阶段：DHCP、tfptd Server 安装和配置</text><polygon fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" points="368,111.4297,582,111.4297,592,122.4297,582,134.4297,368,134.4297,358,122.4297,368,111.4297" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="370" y="127.4966">dnsmasq: DHCP + DNS + TFTPD</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="160.6953" y2="160.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="160.6953" y2="173.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="173.6953" y2="173.6953"/><polygon fill="#A80036" points="486,169.6953,476,173.6953,486,177.6953,482,173.6953" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="482" y="155.6294">配置 Server IP</text><path d="M279,153.5625 L279,163.5625 A7.5,7.5 0 0 0 286.5,171.0625 L458.5,171.0625 A7.5,7.5 0 0 0 466,163.5625 L466,156.0625 L456,146.0625 L286.5,146.0625 A7.5,7.5 0 0 0 279,153.5625 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,146.0625 L456,152.3125 A3.75,3.75 0 0 0 459.75,156.0625 L466,156.0625 L456,146.0625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="285" y="163.1294">192.168.0.11 # 以 11 为例</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="202.8281" y2="202.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="202.8281" y2="215.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="215.8281" y2="215.8281"/><polygon fill="#A80036" points="486,211.8281,476,215.8281,486,219.8281,482,215.8281" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="482" y="197.7622">安装 dnsmasq</text><path d="M285,195.6953 L285,205.6953 A7.5,7.5 0 0 0 292.5,213.1953 L458.5,213.1953 A7.5,7.5 0 0 0 466,205.6953 L466,198.1953 L456,188.1953 L292.5,188.1953 A7.5,7.5 0 0 0 285,195.6953 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,188.1953 L456,194.4453 A3.75,3.75 0 0 0 459.75,198.1953 L466,198.1953 L456,188.1953 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="291" y="205.2622">sudo apt install dnsmasq</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="244.9609" y2="244.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="244.9609" y2="257.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="257.9609" y2="257.9609"/><polygon fill="#A80036" points="486,253.9609,476,257.9609,486,261.9609,482,257.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="482" y="239.895">创建 tftp 根路径</text><path d="M247,237.8281 L247,247.8281 A7.5,7.5 0 0 0 254.5,255.3281 L458.5,255.3281 A7.5,7.5 0 0 0 466,247.8281 L466,240.3281 L456,230.3281 L254.5,230.3281 A7.5,7.5 0 0 0 247,237.8281 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,230.3281 L456,236.5781 A3.75,3.75 0 0 0 459.75,240.3281 L466,240.3281 L456,230.3281 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="253" y="247.395">sudo mkdir -p /srv/tftp --</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="412" y="247.395">(注 0)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="323.4258" y2="323.4258"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="323.4258" y2="336.4258"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="336.4258" y2="336.4258"/><polygon fill="#A80036" points="486,332.4258,476,336.4258,486,340.4258,482,336.4258" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="482" y="318.3599">config dnsmasq</text><path d="M153,278.4609 L153,363.4609 A7.5,7.5 0 0 0 160.5,370.9609 L458.5,370.9609 A7.5,7.5 0 0 0 466,363.4609 L466,280.9609 L456,270.9609 L160.5,270.9609 A7.5,7.5 0 0 0 153,278.4609 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,270.9609 L456,277.2109 A3.75,3.75 0 0 0 459.75,280.9609 L466,280.9609 L456,270.9609 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="159" y="288.0278">sudo vi /etc/dnsmasq.conf</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="255" x="175" y="303.1606">conf-dir=/etc/dnsmasq.d # 去掉此行注释</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="163" y="318.2935"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="159" y="333.4263">sudo vi /etc/dnsmasq.d/pxe.conf --</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="383" y="333.4263">(注 1)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="159" y="348.5591">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="175" y="348.5591">为后续 Legacy、UEFI 两者模式加载不同的文件</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="159" y="363.6919">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="175" y="363.6919">打开 tftp 并配置根路径</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="430.6563" y2="430.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="430.6563" y2="443.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="443.6563" y2="443.6563"/><polygon fill="#A80036" points="486,439.6563,476,443.6563,486,447.6563,482,443.6563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="482" y="425.5903">start dnsmasq</text><path d="M156,393.2578 L156,463.2578 A7.5,7.5 0 0 0 163.5,470.7578 L458.5,470.7578 A7.5,7.5 0 0 0 466,463.2578 L466,395.7578 L456,385.7578 L163.5,385.7578 A7.5,7.5 0 0 0 156,393.2578 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,385.7578 L456,392.0078 A3.75,3.75 0 0 0 459.75,395.7578 L466,395.7578 L456,385.7578 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="162" y="402.8247">sudo systemctl restart dnsmasq.service</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="166" y="417.9575"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="162" y="433.0903">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="273" x="178" y="433.0903">若其他 tftpd(如：tftpd-hpa）在运行，请 stop</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="162" y="448.2231">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="178" y="448.2231">关注防火墙</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="162" y="463.356">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="178" y="463.356">可用 sudo dnsmasq --no-daemon 跟踪测试</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="545.4531" y2="545.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="545.4531" y2="558.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="558.4531" y2="558.4531"/><polygon fill="#A80036" points="486,554.4531,476,558.4531,486,562.4531,482,558.4531" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="482" y="540.3872">下载并挂载 ISO —— 可选</text><path d="M75,492.9219 L75,592.9219 A7.5,7.5 0 0 0 82.5,600.4219 L458.5,600.4219 A7.5,7.5 0 0 0 466,592.9219 L466,495.4219 L456,485.4219 L82.5,485.4219 A7.5,7.5 0 0 0 75,492.9219 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,485.4219 L456,491.6719 A3.75,3.75 0 0 0 459.75,495.4219 L466,495.4219 L456,485.4219 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="81" y="502.4888">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="97" y="502.4888">下载 ISO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320" x="89" y="517.6216">- http://mirrors.zte.com.cn/ubuntu-releases/20.04/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="81" y="532.7544">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="97" y="532.7544">挂载 ISO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="362" x="89" y="547.8872">- sudo mount ubuntu-20.04.2.0-desktop-amd64.iso /mnt</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="81" y="563.02">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="97" y="563.02">链接到 tftp -- 仅为后续提取文件方便</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="89" y="578.1528">- sudo mkdir -p /srv/tftp/ubuntu/20.04</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="89" y="593.2856">- sudo ln -s /mnt /srv/tftp/ubuntu/20.04</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="720.7813" y2="720.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="720.7813" y2="733.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="733.7813" y2="733.7813"/><polygon fill="#A80036" points="486,729.7813,476,733.7813,486,737.7813,482,733.7813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="482" y="715.7153">准备 kernel、ramdisk</text><path d="M15,622.8516 L15,813.8516 A7.5,7.5 0 0 0 22.5,821.3516 L458.5,821.3516 A7.5,7.5 0 0 0 466,813.8516 L466,625.3516 L456,615.3516 L22.5,615.3516 A7.5,7.5 0 0 0 15,622.8516 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,615.3516 L456,621.6016 A3.75,3.75 0 0 0 459.75,625.3516 L466,625.3516 L456,615.3516 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="21" y="632.4185">【方法1】-- netboot 中提取</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="188" y="632.4185">未压缩版</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="244" y="632.4185">—— 支持 ip 配置并从 mirrors 安装</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="21" y="647.5513">http://mirrors.zte.com.cn/ubuntu/dists/focal/main/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="21" y="662.6841">installer-amd64/current/legacy-images/netboot/netboot.tar.gz</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="21" y="677.8169">sudo tar -xzvf netboot.tar.gz -C /srv/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="21" y="692.9497">得到以下文件：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="21" y="708.0825">$ ls netboot/ubuntu-installer/amd64/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="21" y="723.2153">boot-screens</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="62" x="113" y="723.2153">initrd.gz</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="183" y="723.2153"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="34" x="183" y="723.2153">linux</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="221" y="723.2153">pxelinux.0  pxelinux.cfg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="25" y="738.3481"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="21" y="753.481">【方法2】-- ISO/casper 中提取</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="207" y="753.481">压缩版</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="250" y="753.481">—— 支持 CLI args 从 nfs 安装</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="21" y="768.6138">cp /mnt/casper/{vmlinuz,initrd} /srv/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="25" y="783.7466"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="21" y="798.8794">- 16.04(Xenial),18.04(Bionic),20.04(Focal)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="347" x="21" y="814.0122">- linux(kernel),vmlinux(vm kernel),vmlinuz(zip vmlinux)</text><rect fill="#EEEEEE" filter="url(#fm6ihpdvodsfn)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1210" x="0" y="851.6445"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1210" y1="851.6445" y2="851.6445"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1210" y1="854.6445" y2="854.6445"/><rect fill="#EEEEEE" filter="url(#fm6ihpdvodsfn)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="301" x="454.5" y="841.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="282" x="460.5" y="857.145">第 2 阶段：UEFI 或 Lagecy 的 bootloader</text><polygon fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" points="827,879.2109,857,879.2109,867,890.2109,857,902.2109,827,902.2109,817,890.2109,827,879.2109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="829" y="895.2778">上电</text><path d="M17.5,914.3438 L113,914.3438 L113,921.3438 L103,931.3438 L10,931.3438 L10,921.8438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="376.6563" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="939" x="10" y="914.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="58" x="25" y="927.4106">(1) UEFI</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="1019.207" y2="1019.207"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="1019.207" y2="1032.207"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="1032.207" y2="1032.207"/><polygon fill="#A80036" points="486,1028.207,476,1032.207,486,1036.207,482,1032.207" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="482" y="1014.1411">准备 bootloader(bootx64.efi + grubx64.efi)</text><path d="M20,943.9766 L20,1089.9766 A7.5,7.5 0 0 0 27.5,1097.4766 L458.5,1097.4766 A7.5,7.5 0 0 0 466,1089.9766 L466,946.4766 L456,936.4766 L27.5,936.4766 A7.5,7.5 0 0 0 20,943.9766 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,936.4766 L456,942.7266 A3.75,3.75 0 0 0 459.75,946.4766 L466,946.4766 L456,936.4766 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="26" y="953.5435">【方法1】-- apt 提取 signed 版 —— signed 版本</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="412" x="26" y="968.6763">apt download grub-efi-amd64-signed shim-signed grub-common</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="26" y="983.8091">(注 2)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="30" y="998.9419"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="425" x="26" y="1014.0747">【方法2】-- ISO/EFI 中提取 —— BIOS 中使能 security boot 会验证失败</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="26" y="1029.2075">cp /mnt/EFI/BOOT/* /srv/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="30" y="1044.3403"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="26" y="1059.4731">【方法3】-- grub-mknetdir 命令生成</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="26" y="1074.606">grub-mknetdir</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="142" x="121" y="1074.606">net-directory=/srv/tftp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="267" y="1074.606">subdir=/boot/grub</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="30" y="1089.7388">-d /usr/lib/grub/&lt;i386-pc | x86_64-efi&gt;</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="1156.7031" y2="1156.7031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="1156.7031" y2="1169.7031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="1169.7031" y2="1169.7031"/><polygon fill="#A80036" points="486,1165.7031,476,1169.7031,486,1173.7031,482,1169.7031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="482" y="1151.6372">配置 grub --</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="555" y="1151.6372">(注 3)</text><path d="M144,1119.3047 L144,1189.3047 A7.5,7.5 0 0 0 151.5,1196.8047 L458.5,1196.8047 A7.5,7.5 0 0 0 466,1189.3047 L466,1121.8047 L456,1111.8047 L151.5,1111.8047 A7.5,7.5 0 0 0 144,1119.3047 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,1111.8047 L456,1118.0547 A3.75,3.75 0 0 0 459.75,1121.8047 L466,1121.8047 L456,1111.8047 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="150" y="1128.8716">sudo vi /srv/tftp/grub/grub.cfg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="154" y="1144.0044"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="150" y="1159.1372">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="166" y="1159.1372">添加 grub 菜单</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="150" y="1174.27">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="166" y="1174.27">配置 kernel、initrd 文件路径、和参数</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="150" y="1189.4028">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="166" y="1189.4028">配置 CLI args：从 mirrors url 或 nfs 安装（</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="12" x="426" y="1189.4028">★</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="438" y="1189.4028">）</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="884" y1="1248.8008" y2="1248.8008"/><line style="stroke:#A80036;stroke-width:1.0;" x1="884" x2="884" y1="1248.8008" y2="1261.8008"/><line style="stroke:#A80036;stroke-width:1.0;" x1="843" x2="884" y1="1261.8008" y2="1261.8008"/><polygon fill="#A80036" points="853,1257.8008,843,1261.8008,853,1265.8008,849,1261.8008" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="849" y="1243.7349">F12 修改 BIOS</text><path d="M474,1218.9688 L474,1273.9688 A7.5,7.5 0 0 0 481.5,1281.4688 L825.5,1281.4688 A7.5,7.5 0 0 0 833,1273.9688 L833,1221.4688 L823,1211.4688 L481.5,1211.4688 A7.5,7.5 0 0 0 474,1218.9688 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M823,1211.4688 L823,1217.7188 A3.75,3.75 0 0 0 826.75,1221.4688 L833,1221.4688 L823,1211.4688 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="480" y="1228.5356">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="496" y="1228.5356">boot sequence：net first ——</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="687" y="1228.5356">唯一必配项</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="496" y="1243.6685"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="12" x="496" y="1243.6685">★</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="512" y="1243.6685">双网卡 PC 有时把集成网卡认做网卡2 -- 害死人！</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="480" y="1258.8013">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="496" y="1258.8013">net interface mode：uefi —— 很多 BIOS 已经不可选</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="480" y="1273.9341">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="496" y="1273.9341">security boot：enable —— 关系 bootloader 验证</text><path d="M59.5,1305 L217,1305 L217,1312 L207,1322 L52,1322 L52,1312.5 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="370.3906" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="897" x="52" y="1305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="120" x="67" y="1318.0669">(2) BIOS(lagecy)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="1402.2969" y2="1402.2969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="1402.2969" y2="1415.2969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="1415.2969" y2="1415.2969"/><polygon fill="#A80036" points="486,1411.2969,476,1415.2969,486,1419.2969,482,1415.2969" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="482" y="1397.231">准备 bootloader(pxelinux.0)</text><path d="M78,1334.6328 L78,1465.6328 A7.5,7.5 0 0 0 85.5,1473.1328 L458.5,1473.1328 A7.5,7.5 0 0 0 466,1465.6328 L466,1337.1328 L456,1327.1328 L85.5,1327.1328 A7.5,7.5 0 0 0 78,1334.6328 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,1327.1328 L456,1333.3828 A3.75,3.75 0 0 0 459.75,1337.1328 L466,1337.1328 L456,1327.1328 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="84" y="1344.1997">【方式1】-- 从 netboot 中提取</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="84" y="1359.3325">见“准备 kernel、ramdisk”中【方法一】</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="84" y="1374.4653">【方式2】-- 从 syslinux 提取 ——</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="289" y="1374.4653">(注 4)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="84" y="1389.5981">sudo apt install syslinux</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="305" x="84" y="1404.731">sudo cp /usr/lib/syslinux/vesamenu.c32 /srv/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="84" y="1419.8638">sudo cp /usr/lib/syslinux/pxelinux.0 /srv/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="367" x="84" y="1434.9966">sudo cp /usr/lib/syslinux/modules/bios/ldlinux.c32 /srv/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="88" y="1450.1294"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="84" y="1465.2622">【方式3】-- 从 ISO 提取 ——</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138" x="261" y="1465.2622">后来很多 ISO 都没有了</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="1524.6602" y2="1524.6602"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="1524.6602" y2="1537.6602"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="1537.6602" y2="1537.6602"/><polygon fill="#A80036" points="486,1533.6602,476,1537.6602,486,1541.6602,482,1537.6602" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="482" y="1519.5942">配置 pxelinux --</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="582" y="1519.5942">(注 5)</text><path d="M62,1494.8281 L62,1549.8281 A7.5,7.5 0 0 0 69.5,1557.3281 L458.5,1557.3281 A7.5,7.5 0 0 0 466,1549.8281 L466,1497.3281 L456,1487.3281 L69.5,1487.3281 A7.5,7.5 0 0 0 62,1494.8281 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,1487.3281 L456,1493.5781 A3.75,3.75 0 0 0 459.75,1497.3281 L466,1497.3281 L456,1487.3281 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="68" y="1504.395">新版:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="383" x="68" y="1519.5278">sudo vi /srv/tftp/ubuntu-installer/amd64/boot-screens/txt.cfg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="68" y="1534.6606">旧版:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="68" y="1549.7935">sudo vi /srv/tftp/pxelinux.cfg/default</text><path d="M770,1579.3594 L770,1589.3594 A7.5,7.5 0 0 0 777.5,1596.8594 L901.5,1596.8594 A7.5,7.5 0 0 0 909,1589.3594 L909,1581.8594 L899,1571.8594 L777.5,1571.8594 A7.5,7.5 0 0 0 770,1579.3594 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M899,1571.8594 L899,1578.1094 A3.75,3.75 0 0 0 902.75,1581.8594 L909,1581.8594 L899,1571.8594 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="776" y="1588.9263">硬件注意项</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="841" y="1588.9263">（注 6）</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="884" y1="1640.7578" y2="1640.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="884" x2="884" y1="1640.7578" y2="1653.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="843" x2="884" y1="1653.7578" y2="1653.7578"/><polygon fill="#A80036" points="853,1649.7578,843,1653.7578,853,1657.7578,849,1653.7578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="849" y="1635.6919">F12 修改 BIOS</text><path d="M638,1618.4922 L638,1658.4922 A7.5,7.5 0 0 0 645.5,1665.9922 L825.5,1665.9922 A7.5,7.5 0 0 0 833,1658.4922 L833,1620.9922 L823,1610.9922 L645.5,1610.9922 A7.5,7.5 0 0 0 638,1618.4922 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M823,1610.9922 L823,1617.2422 A3.75,3.75 0 0 0 826.75,1620.9922 L833,1620.9922 L823,1610.9922 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="644" y="1628.0591">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="660" y="1628.0591">boot sequence：net first</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="644" y="1643.1919">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="660" y="1643.1919">net interface mode：pxe</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="644" y="1658.3247">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="660" y="1658.3247">security boot：disable</text><polygon fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" points="788,1687.3906,896,1687.3906,906,1698.3906,896,1710.3906,788,1710.3906,778,1698.3906,788,1687.3906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="790" y="1703.4575">保存 BISO 请重启</text><polygon fill="#A80036" points="486,1732.6563,476,1736.6563,486,1740.6563,482,1736.6563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="480" x2="841" y1="1736.6563" y2="1736.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="492" y="1731.5903">DHCP/bootp</text><polygon fill="#A80036" points="830,1761.7891,840,1765.7891,830,1769.7891,834,1765.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="836" y1="1765.7891" y2="1765.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="482" y="1760.7231">分配 IP &amp; bootloader 地址</text><polygon fill="#A80036" points="830,1790.9219,840,1794.9219,830,1798.9219,834,1794.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="836" y1="1794.9219" y2="1794.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="482" y="1789.856">下载 bootloader(bootx64.efi/grubx64.efi 或 pxelinux.0)</text><rect fill="#EEEEEE" filter="url(#fm6ihpdvodsfn)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1210" x="0" y="1823.4883"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1210" y1="1823.4883" y2="1823.4883"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1210" y1="1826.4883" y2="1826.4883"/><rect fill="#EEEEEE" filter="url(#fm6ihpdvodsfn)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="341" x="434.5" y="1812.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="322" x="440.5" y="1828.9888">第 3 阶段：kernel 运行和 OS 安装（http or nfs）</text><polygon fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" points="790,1851.0547,893,1851.0547,903,1862.0547,893,1874.0547,790,1874.0547,780,1862.0547,790,1851.0547" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="792" y="1867.1216">bootloader 接权</text><polygon fill="#A80036" points="830,1896.3203,840,1900.3203,830,1904.3203,834,1900.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="836" y1="1900.3203" y2="1900.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="343" x="482" y="1895.2544">下载 configuration(包含 kernel,ramdisk,kernel CLI 路径)</text><polygon fill="#A80036" points="830,1925.4531,840,1929.4531,830,1933.4531,834,1929.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="836" y1="1929.4531" y2="1929.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="482" y="1924.3872">下载 kernel,ramdisk, kernel CLI args</text><path d="M426,1949.9531 L426,1959.9531 A7.5,7.5 0 0 0 433.5,1967.4531 L1153.5,1967.4531 A7.5,7.5 0 0 0 1161,1959.9531 L1161,1952.4531 L1151,1942.4531 L433.5,1942.4531 A7.5,7.5 0 0 0 426,1949.9531 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1151,1942.4531 L1151,1948.7031 A3.75,3.75 0 0 0 1154.75,1952.4531 L1161,1952.4531 L1151,1942.4531 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="531.5" y="1959.52">下面 kernel 接权，使用哪种模式获取安装包取决于</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119" x="825.5" y="1959.52">（注 3）或（注 5）</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="944.5" y="1959.52">中 CLI args 配置</text><path d="M35.5,1983.5859 L464,1983.5859 L464,1990.5859 L454,2000.5859 L28,2000.5859 L28,1991.0859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="200.1953" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="931" x="28" y="1983.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="391" x="43" y="1996.6528">(1) NFS install by ISO/casper kernel with nfs CLI args</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="517" y1="2058.1836" y2="2058.1836"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="517" y1="2058.1836" y2="2071.1836"/><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="517" y1="2071.1836" y2="2071.1836"/><polygon fill="#A80036" points="486,2067.1836,476,2071.1836,486,2075.1836,482,2071.1836" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="482" y="2053.1177">配置 NFS server</text><path d="M38,2013.2188 L38,2098.2188 A7.5,7.5 0 0 0 45.5,2105.7188 L458.5,2105.7188 A7.5,7.5 0 0 0 466,2098.2188 L466,2015.7188 L456,2005.7188 L45.5,2005.7188 A7.5,7.5 0 0 0 38,2013.2188 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M456,2005.7188 L456,2011.9688 A3.75,3.75 0 0 0 459.75,2015.7188 L466,2015.7188 L456,2005.7188 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="44" y="2022.7856">sudo apt install nfs-kernel-server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="44" y="2037.9185">sudo vi /etc/exports</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="399" x="52" y="2053.0513">/srv/tftp/ubuntu *(ro,async,no_root_squash,no_subtree_check)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="44" y="2068.1841">sudo exportfs -a # 全部挂载或者全部卸</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="44" y="2083.3169">sudo exportfs -v # 显示共享目</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="44" y="2098.4497">sudo /etc/init.d/nfs-kernel-server start</text><path d="M734,2128.0156 L734,2138.0156 A7.5,7.5 0 0 0 741.5,2145.5156 L937.5,2145.5156 A7.5,7.5 0 0 0 945,2138.0156 L945,2130.5156 L935,2120.5156 L741.5,2120.5156 A7.5,7.5 0 0 0 734,2128.0156 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M935,2120.5156 L935,2126.7656 A3.75,3.75 0 0 0 938.75,2130.5156 L945,2130.5156 L935,2120.5156 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="740" y="2137.5825">解析出 nfsroot 的 CLI args 参数</text><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="485" y1="2175.7813" y2="2171.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="485" y1="2175.7813" y2="2179.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="840" x2="830" y1="2175.7813" y2="2179.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="841" y1="2175.7813" y2="2175.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="492" y="2170.7153">从nfs下载并安装包</text><path d="M513.5,2197.7813 L919,2197.7813 L919,2204.7813 L909,2214.7813 L506,2214.7813 L506,2205.2813 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="491.3906" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="694" x="506" y="2197.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="368" x="521" y="2210.8481">(2) http install by netboot kernel without CLI args</text><path d="M711,2227.4141 L711,2252.4141 A7.5,7.5 0 0 0 718.5,2259.9141 L960.5,2259.9141 A7.5,7.5 0 0 0 968,2252.4141 L968,2229.9141 L958,2219.9141 L718.5,2219.9141 A7.5,7.5 0 0 0 711,2227.4141 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M958,2219.9141 L958,2226.1641 A3.75,3.75 0 0 0 961.75,2229.9141 L968,2229.9141 L958,2219.9141 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="717" y="2236.981">netboot/ubuntu-installer/amd64/linux</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="717" y="2252.1138">进去其图形界面</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="884" y1="2290.3125" y2="2290.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="884" x2="884" y1="2290.3125" y2="2303.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="843" x2="884" y1="2303.3125" y2="2303.3125"/><polygon fill="#A80036" points="853,2299.3125,843,2303.3125,853,2307.3125,849,2303.3125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="849" y="2285.2466">配置语言、键盘、时间等</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="884" y1="2338.5117" y2="2338.5117"/><line style="stroke:#A80036;stroke-width:1.0;" x1="884" x2="884" y1="2338.5117" y2="2351.5117"/><line style="stroke:#A80036;stroke-width:1.0;" x1="843" x2="884" y1="2351.5117" y2="2351.5117"/><polygon fill="#A80036" points="853,2347.5117,843,2351.5117,853,2355.5117,849,2351.5117" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="849" y="2333.4458">（另一）网卡转接大网，配置大网 IP</text><path d="M654,2323.8125 L654,2348.8125 A7.5,7.5 0 0 0 661.5,2356.3125 L825.5,2356.3125 A7.5,7.5 0 0 0 833,2348.8125 L833,2326.3125 L823,2316.3125 L661.5,2316.3125 A7.5,7.5 0 0 0 654,2323.8125 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M823,2316.3125 L823,2322.5625 A3.75,3.75 0 0 0 826.75,2326.3125 L833,2326.3125 L823,2316.3125 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="660" y="2333.3794">10.227.14.235/23 ——</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="12" x="806" y="2333.3794">★</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="660" y="2348.5122">10.227.14.1</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="884" y1="2400.3438" y2="2400.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="884" x2="884" y1="2400.3438" y2="2413.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="843" x2="884" y1="2413.3438" y2="2413.3438"/><polygon fill="#A80036" points="853,2409.3438,843,2413.3438,853,2417.3438,849,2413.3438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="849" y="2395.2778">配置 Ubuntu Archive Mirror</text><path d="M610,2378.0781 L610,2418.0781 A7.5,7.5 0 0 0 617.5,2425.5781 L825.5,2425.5781 A7.5,7.5 0 0 0 833,2418.0781 L833,2380.5781 L823,2370.5781 L617.5,2370.5781 A7.5,7.5 0 0 0 610,2378.0781 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M823,2370.5781 L823,2376.8281 A3.75,3.75 0 0 0 826.75,2380.5781 L833,2380.5781 L823,2370.5781 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="616" y="2387.645">cn.archive.ubuntu.com</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="624" y="2402.7778">或ZTEmirror：10.31.194.13:80</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="616" y="2417.9106">/ubuntu/</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="852" y1="2456.1094" y2="2460.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1111" x2="1101" y1="2456.1094" y2="2452.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1111" x2="1101" y1="2456.1094" y2="2460.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="1112" y1="2456.1094" y2="2456.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="859" y="2451.0435">dists/focal/main/binary-amd64/Release</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="852" y1="2485.2422" y2="2489.2422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1111" x2="1101" y1="2485.2422" y2="2481.2422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1111" x2="1101" y1="2485.2422" y2="2489.2422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="1112" y1="2485.2422" y2="2485.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="859" y="2480.1763">dists/focal/Release</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="852" y1="2514.375" y2="2518.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1111" x2="1101" y1="2514.375" y2="2510.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1111" x2="1101" y1="2514.375" y2="2518.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="1112" y1="2514.375" y2="2514.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="859" y="2509.3091">dists/focal/Release.gpg</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="884" y1="2549.5742" y2="2549.5742"/><line style="stroke:#A80036;stroke-width:1.0;" x1="884" x2="884" y1="2549.5742" y2="2562.5742"/><line style="stroke:#A80036;stroke-width:1.0;" x1="843" x2="884" y1="2562.5742" y2="2562.5742"/><polygon fill="#A80036" points="853,2558.5742,843,2562.5742,853,2566.5742,849,2562.5742" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="849" y="2544.5083">配置账号、语言、时区、分区</text><path d="M547,2534.875 L547,2559.875 A7.5,7.5 0 0 0 554.5,2567.375 L825.5,2567.375 A7.5,7.5 0 0 0 833,2559.875 L833,2537.375 L823,2527.375 L554.5,2527.375 A7.5,7.5 0 0 0 547,2534.875 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M823,2527.375 L823,2533.625 A3.75,3.75 0 0 0 826.75,2537.375 L833,2537.375 L823,2527.375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="12" x="553" y="2544.4419">★</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="569" y="2544.4419">全盘安装 —— 2个disk时还是需手配挂载点</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="12" x="553" y="2559.5747">★</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="569" y="2559.5747">剩余空间安装 —— 谨慎</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="852" y1="2597.7734" y2="2601.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1111" x2="1101" y1="2597.7734" y2="2593.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1111" x2="1101" y1="2597.7734" y2="2601.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="1112" y1="2597.7734" y2="2597.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="859" y="2592.7075">安装基础包</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="884" y1="2632.9727" y2="2632.9727"/><line style="stroke:#A80036;stroke-width:1.0;" x1="884" x2="884" y1="2632.9727" y2="2645.9727"/><line style="stroke:#A80036;stroke-width:1.0;" x1="843" x2="884" y1="2645.9727" y2="2645.9727"/><line style="stroke:#A80036;stroke-width:1.0;" x1="843" x2="853" y1="2645.9727" y2="2649.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="849" y="2627.9067">配置可选包</text><path d="M516,2618.2734 L516,2643.2734 A7.5,7.5 0 0 0 523.5,2650.7734 L825.5,2650.7734 A7.5,7.5 0 0 0 833,2643.2734 L833,2620.7734 L823,2610.7734 L523.5,2610.7734 A7.5,7.5 0 0 0 516,2618.2734 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M823,2610.7734 L823,2617.0234 A3.75,3.75 0 0 0 826.75,2620.7734 L833,2620.7734 L823,2610.7734 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="12" x="522" y="2627.8403">★</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="538" y="2627.8403">是否选择 realtime Kernel -- 需理解 lowlatency</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="12" x="522" y="2642.9731">★</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="538" y="2642.9731">是否选择 studio desktop -- 需理解 x server</text><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="852" y1="2681.1719" y2="2685.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1111" x2="1101" y1="2681.1719" y2="2677.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1111" x2="1101" y1="2681.1719" y2="2685.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="842" x2="1112" y1="2681.1719" y2="2681.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="859" y="2676.106">安装可选包</text><path d="M447.5,2703.1719 L826,2703.1719 L826,2710.1719 L816,2720.1719 L440,2720.1719 L440,2710.6719 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.2656" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="434.5" x="440" y="2703.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="341" x="455" y="2716.2388">(3) http install by any kernel with ISO CLI args</text><polygon fill="#A80036" points="830,2737.4375,840,2741.4375,830,2745.4375,834,2741.4375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="475" x2="836" y1="2741.4375" y2="2741.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="482" y="2736.3716">ISO</text><path d="M788,2768.9375 L788,2778.9375 A7.5,7.5 0 0 0 795.5,2786.4375 L884.5,2786.4375 A7.5,7.5 0 0 0 892,2778.9375 L892,2771.4375 L882,2761.4375 L795.5,2761.4375 A7.5,7.5 0 0 0 788,2768.9375 " fill="#FBFB77" filter="url(#fm6ihpdvodsfn)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M882,2761.4375 L882,2767.6875 A3.75,3.75 0 0 0 885.75,2771.4375 L892,2771.4375 L882,2761.4375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="794" y="2778.5044">善后</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="824" y="2778.5044">（注 7）</text><!--MD5=[15841b02c8b9236f13b6e661dad035b9]
@startuml
skinparam roundCorner 15

entity Server as s
entity Client as c
entity "Ubuntu Archive Mirror" as u

''''''''''''''''''''''''''''''
== 第 1 阶段：DHCP、tfptd Server 安装和配置 ==
''''''''''''''''''''''''''''''

hnote over s:dnsmasq: DHCP + DNS + TFTPD

s->s:配置 Server IP
note left
192.168.0.11 # 以 11 为例
end note

s->s:安装 dnsmasq
note left
sudo apt install dnsmasq
end note

s->s:创建 tftp 根路径
note left
sudo mkdir -p /srv/tftp - - **(注 0)**
end note

s -> s: config dnsmasq
note left
sudo vi /etc/dnsmasq.conf
    conf-dir=/etc/dnsmasq.d # 去掉此行注释

sudo vi /etc/dnsmasq.d/pxe.conf - - **(注 1)**
# 为后续 Legacy、UEFI 两者模式加载不同的文件
# 打开 tftp 并配置根路径
end note

s -> s: start dnsmasq
note left
sudo systemctl restart dnsmasq.service

# 若其他 tftpd(如：tftpd-hpa）在运行，请 stop
# 关注防火墙
# 可用 sudo dnsmasq - -no-daemon 跟踪测试
end note

s->s:下载并挂载 ISO —— 可选
note left
# 下载 ISO
  - http://mirrors.zte.com.cn/ubuntu-releases/20.04/
# 挂载 ISO
  - sudo mount ubuntu-20.04.2.0-desktop-amd64.iso /mnt
# 链接到 tftp - - 仅为后续提取文件方便
  - sudo mkdir -p /srv/tftp/ubuntu/20.04
  - sudo ln -s /mnt /srv/tftp/ubuntu/20.04
end note

s->s:准备 kernel、ramdisk
note left
【方法1】- - netboot 中提取**未压缩版** —— 支持 ip 配置并从 mirrors 安装
http://mirrors.zte.com.cn/ubuntu/dists/focal/main/
installer-amd64/current/legacy-images/netboot/netboot.tar.gz
sudo tar -xzvf netboot.tar.gz -C /srv/tftp/
得到以下文件：
$ ls netboot/ubuntu-installer/amd64/
boot-screens  **initrd.gz**  **linux** pxelinux.0  pxelinux.cfg

【方法2】- - ISO/casper 中提取**压缩版** —— 支持 CLI args 从 nfs 安装
cp /mnt/casper/{vmlinuz,initrd} /srv/tftp/

- 16.04(Xenial),18.04(Bionic),20.04(Focal)
- linux(kernel),vmlinux(vm kernel),vmlinuz(zip vmlinux)
end note


''''''''''''''''''''''''''''''
== 第 2 阶段：UEFI 或 Lagecy 的 bootloader ==
''''''''''''''''''''''''''''''
hnote over c:上电

group (1) UEFI

s->s:准备 bootloader(bootx64.efi + grubx64.efi)
note left
【方法1】- - apt 提取 signed 版 —— signed 版本
apt download grub-efi-amd64-signed shim-signed grub-common
**(注 2)**

【方法2】- - ISO/EFI 中提取 —— BIOS 中使能 security boot 会验证失败
cp /mnt/EFI/BOOT/* /srv/tftp/

【方法3】- - grub-mknetdir 命令生成
grub-mknetdir - -net-directory=/srv/tftp - -subdir=/boot/grub
 -d /usr/lib/grub/<i386-pc | x86_64-efi>
end note

s->s:配置 grub - -**(注 3)**
note left
sudo vi /srv/tftp/grub/grub.cfg

# 添加 grub 菜单
# 配置 kernel、initrd 文件路径、和参数
# 配置 CLI args：从 mirrors url 或 nfs 安装（**★**）
end note

c->c:F12 修改 BIOS
note left
# boot sequence：net first —— **唯一必配项**
    **★** 双网卡 PC 有时把集成网卡认做网卡2 - - 害死人！
# net interface mode：uefi —— 很多 BIOS 已经不可选
# security boot：enable —— 关系 bootloader 验证
end note

end


group (2) BIOS(lagecy)

s->s:准备 bootloader(pxelinux.0)
note left
【方式1】- - 从 netboot 中提取
见“准备 kernel、ramdisk”中【方法一】
【方式2】- - 从 syslinux 提取 —— **(注 4)**
sudo apt install syslinux
sudo cp /usr/lib/syslinux/vesamenu.c32 /srv/tftp/
sudo cp /usr/lib/syslinux/pxelinux.0 /srv/tftp/
sudo cp /usr/lib/syslinux/modules/bios/ldlinux.c32 /srv/tftp/

【方式3】- - 从 ISO 提取 —— **后来很多 ISO 都没有了**
end note

s->s:配置 pxelinux - - **(注 5)**
note left
新版:
sudo vi /srv/tftp/ubuntu-installer/amd64/boot-screens/txt.cfg
旧版:
sudo vi /srv/tftp/pxelinux.cfg/default
end note

note over c:硬件注意项**（注 6）**
c->c:F12 修改 BIOS
note left
# boot sequence：net first
# net interface mode：pxe
# security boot：disable
end note

end


hnote over c:保存 BISO 请重启
c->s:DHCP/bootp
s->c:分配 IP & bootloader 地址
s->c:下载 bootloader(bootx64.efi/grubx64.efi 或 pxelinux.0)

''''''''''''''''''''''''''''''
== 第 3 阶段：kernel 运行和 OS 安装（http or nfs） ==
''''''''''''''''''''''''''''''

hnote over c:bootloader 接权
s->c:下载 configuration(包含 kernel,ramdisk,kernel CLI 路径)
s->c:下载 kernel,ramdisk, kernel CLI args

note over u,s:下面 kernel 接权，使用哪种模式获取安装包取决于**（注 3）或（注 5）**中 CLI args 配置

group (1) NFS install by ISO/casper kernel with nfs CLI args
s->s:配置 NFS server
note left
sudo apt install nfs-kernel-server
sudo vi /etc/exports
  /srv/tftp/ubuntu *(ro,async,no_root_squash,no_subtree_check)
sudo exportfs -a # 全部挂载或者全部卸
sudo exportfs -v # 显示共享目
sudo /etc/init.d/nfs-kernel-server start
end note

note over c:解析出 nfsroot 的 CLI args 参数

s\\-\c:从nfs下载并安装包
end

group (2) http install by netboot kernel without CLI args
note over c:netboot/ubuntu-installer/amd64/linux\n进去其图形界面
c->c:配置语言、键盘、时间等
c->c:（另一）网卡转接大网，配置大网 IP
note left
10.227.14.235/23 —— **★**
10.227.14.1
end note
c->c:配置 Ubuntu Archive Mirror
note left
cn.archive.ubuntu.com
  或ZTEmirror：10.31.194.13:80
/ubuntu/
end note
u\\-\c:dists/focal/main/binary-amd64/Release
u\\-\c:dists/focal/Release
u\\-\c:dists/focal/Release.gpg
c->c:配置账号、语言、时区、分区
note left
**★** 全盘安装 —— 2个disk时还是需手配挂载点
**★** 剩余空间安装 —— 谨慎
end note
u\\-\c:安装基础包
c\\-\c:配置可选包
note left
**★** 是否选择 realtime Kernel - - 需理解 lowlatency
**★** 是否选择 studio desktop - - 需理解 x server
end note
u\\-\c:安装可选包
end

group (3) http install by any kernel with ISO CLI args
s -> c : ISO

end

note over c:善后 **（注 7）**
@enduml

@startuml
skinparam roundCorner 15

entity Server as s
entity Client as c
entity "Ubuntu Archive Mirror" as u

== 第 1 阶段：DHCP、tfptd Server 安装和配置 ==

hnote over s:dnsmasq: DHCP + DNS + TFTPD

s->s:配置 Server IP
note left
192.168.0.11 # 以 11 为例
end note

s->s:安装 dnsmasq
note left
sudo apt install dnsmasq
end note

s->s:创建 tftp 根路径
note left
sudo mkdir -p /srv/tftp - - **(注 0)**
end note

s -> s: config dnsmasq
note left
sudo vi /etc/dnsmasq.conf
    conf-dir=/etc/dnsmasq.d # 去掉此行注释

sudo vi /etc/dnsmasq.d/pxe.conf - - **(注 1)**
# 为后续 Legacy、UEFI 两者模式加载不同的文件
# 打开 tftp 并配置根路径
end note

s -> s: start dnsmasq
note left
sudo systemctl restart dnsmasq.service

# 若其他 tftpd(如：tftpd-hpa）在运行，请 stop
# 关注防火墙
# 可用 sudo dnsmasq - -no-daemon 跟踪测试
end note

s->s:下载并挂载 ISO —— 可选
note left
# 下载 ISO
  - http://mirrors.zte.com.cn/ubuntu-releases/20.04/
# 挂载 ISO
  - sudo mount ubuntu-20.04.2.0-desktop-amd64.iso /mnt
# 链接到 tftp - - 仅为后续提取文件方便
  - sudo mkdir -p /srv/tftp/ubuntu/20.04
  - sudo ln -s /mnt /srv/tftp/ubuntu/20.04
end note

s->s:准备 kernel、ramdisk
note left
【方法1】- - netboot 中提取**未压缩版** —— 支持 ip 配置并从 mirrors 安装
http://mirrors.zte.com.cn/ubuntu/dists/focal/main/
installer-amd64/current/legacy-images/netboot/netboot.tar.gz
sudo tar -xzvf netboot.tar.gz -C /srv/tftp/
得到以下文件：
$ ls netboot/ubuntu-installer/amd64/
boot-screens  **initrd.gz**  **linux** pxelinux.0  pxelinux.cfg

【方法2】- - ISO/casper 中提取**压缩版** —— 支持 CLI args 从 nfs 安装
cp /mnt/casper/{vmlinuz,initrd} /srv/tftp/

- 16.04(Xenial),18.04(Bionic),20.04(Focal)
- linux(kernel),vmlinux(vm kernel),vmlinuz(zip vmlinux)
end note


== 第 2 阶段：UEFI 或 Lagecy 的 bootloader ==
hnote over c:上电

group (1) UEFI

s->s:准备 bootloader(bootx64.efi + grubx64.efi)
note left
【方法1】- - apt 提取 signed 版 —— signed 版本
apt download grub-efi-amd64-signed shim-signed grub-common
**(注 2)**

【方法2】- - ISO/EFI 中提取 —— BIOS 中使能 security boot 会验证失败
cp /mnt/EFI/BOOT/* /srv/tftp/

【方法3】- - grub-mknetdir 命令生成
grub-mknetdir - -net-directory=/srv/tftp - -subdir=/boot/grub
 -d /usr/lib/grub/<i386-pc | x86_64-efi>
end note

s->s:配置 grub - -**(注 3)**
note left
sudo vi /srv/tftp/grub/grub.cfg

# 添加 grub 菜单
# 配置 kernel、initrd 文件路径、和参数
# 配置 CLI args：从 mirrors url 或 nfs 安装（**★**）
end note

c->c:F12 修改 BIOS
note left
# boot sequence：net first —— **唯一必配项**
    **★** 双网卡 PC 有时把集成网卡认做网卡2 - - 害死人！
# net interface mode：uefi —— 很多 BIOS 已经不可选
# security boot：enable —— 关系 bootloader 验证
end note

end


group (2) BIOS(lagecy)

s->s:准备 bootloader(pxelinux.0)
note left
【方式1】- - 从 netboot 中提取
见“准备 kernel、ramdisk”中【方法一】
【方式2】- - 从 syslinux 提取 —— **(注 4)**
sudo apt install syslinux
sudo cp /usr/lib/syslinux/vesamenu.c32 /srv/tftp/
sudo cp /usr/lib/syslinux/pxelinux.0 /srv/tftp/
sudo cp /usr/lib/syslinux/modules/bios/ldlinux.c32 /srv/tftp/

【方式3】- - 从 ISO 提取 —— **后来很多 ISO 都没有了**
end note

s->s:配置 pxelinux - - **(注 5)**
note left
新版:
sudo vi /srv/tftp/ubuntu-installer/amd64/boot-screens/txt.cfg
旧版:
sudo vi /srv/tftp/pxelinux.cfg/default
end note

note over c:硬件注意项**（注 6）**
c->c:F12 修改 BIOS
note left
# boot sequence：net first
# net interface mode：pxe
# security boot：disable
end note

end


hnote over c:保存 BISO 请重启
c->s:DHCP/bootp
s->c:分配 IP & bootloader 地址
s->c:下载 bootloader(bootx64.efi/grubx64.efi 或 pxelinux.0)

== 第 3 阶段：kernel 运行和 OS 安装（http or nfs） ==

hnote over c:bootloader 接权
s->c:下载 configuration(包含 kernel,ramdisk,kernel CLI 路径)
s->c:下载 kernel,ramdisk, kernel CLI args

note over u,s:下面 kernel 接权，使用哪种模式获取安装包取决于**（注 3）或（注 5）**中 CLI args 配置

group (1) NFS install by ISO/casper kernel with nfs CLI args
s->s:配置 NFS server
note left
sudo apt install nfs-kernel-server
sudo vi /etc/exports
  /srv/tftp/ubuntu *(ro,async,no_root_squash,no_subtree_check)
sudo exportfs -a # 全部挂载或者全部卸
sudo exportfs -v # 显示共享目
sudo /etc/init.d/nfs-kernel-server start
end note

note over c:解析出 nfsroot 的 CLI args 参数

s\\-\c:从nfs下载并安装包
end

group (2) http install by netboot kernel without CLI args
note over c:netboot/ubuntu-installer/amd64/linux\n进去其图形界面
c->c:配置语言、键盘、时间等
c->c:（另一）网卡转接大网，配置大网 IP
note left
10.227.14.235/23 —— **★**
10.227.14.1
end note
c->c:配置 Ubuntu Archive Mirror
note left
cn.archive.ubuntu.com
  或ZTEmirror：10.31.194.13:80
/ubuntu/
end note
u\\-\c:dists/focal/main/binary-amd64/Release
u\\-\c:dists/focal/Release
u\\-\c:dists/focal/Release.gpg
c->c:配置账号、语言、时区、分区
note left
**★** 全盘安装 —— 2个disk时还是需手配挂载点
**★** 剩余空间安装 —— 谨慎
end note
u\\-\c:安装基础包
c\\-\c:配置可选包
note left
**★** 是否选择 realtime Kernel - - 需理解 lowlatency
**★** 是否选择 studio desktop - - 需理解 x server
end note
u\\-\c:安装可选包
end

group (3) http install by any kernel with ISO CLI args
s -> c : ISO

end

note over c:善后 **（注 7）**
@enduml

PlantUML version 1.2021.4(Sun Apr 04 08:49:39 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>