<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2560px" preserveAspectRatio="none" style="width:1255px;height:2560px;" version="1.1" viewBox="0 0 1255 2560" width="1255px" zoomAndPan="magnify" ml-update="aware"><defs><filter height="300%" id="fjz0vjkgf06x4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fjz0vjkgf06x4)" height="348.8594" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="926" x="61" y="809.5859"/><rect fill="#FFFFFF" filter="url(#fjz0vjkgf06x4)" height="536.3203" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="916" x="71" y="1172.4453"/><rect fill="#FFFFFF" filter="url(#fjz0vjkgf06x4)" height="161.0625" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="902.5" x="10" y="1847.2969"/><rect fill="#FFFFFF" filter="url(#fjz0vjkgf06x4)" height="424.9922" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="510" x="728" y="2022.3594"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="513" x2="513" y1="67.9375" y2="2503.4844"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="879.5" x2="879.5" y1="67.9375" y2="2503.4844"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1151" x2="1151" y1="67.9375" y2="2503.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="488" y="64.6357">Server</text><ellipse cx="513" cy="35.6406" fill="#FEFECE" filter="url(#fjz0vjkgf06x4)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="501" x2="525" y1="49.6406" y2="49.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="488" y="2515.4795">Server</text><ellipse cx="513" cy="2534.7813" fill="#FEFECE" filter="url(#fjz0vjkgf06x4)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="501" x2="525" y1="2548.7813" y2="2548.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="857.5" y="64.6357">Client</text><ellipse cx="880" cy="35.6406" fill="#FEFECE" filter="url(#fjz0vjkgf06x4)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="868" x2="892" y1="49.6406" y2="49.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="857.5" y="2515.4795">Client</text><ellipse cx="880" cy="2534.7813" fill="#FEFECE" filter="url(#fjz0vjkgf06x4)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="868" x2="892" y1="2548.7813" y2="2548.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="1074" y="64.6357">Ubuntu Archive Mirror</text><ellipse cx="1151" cy="35.6406" fill="#FEFECE" filter="url(#fjz0vjkgf06x4)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1139" x2="1163" y1="49.6406" y2="49.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="1074" y="2515.4795">Ubuntu Archive Mirror</text><ellipse cx="1151" cy="2534.7813" fill="#FEFECE" filter="url(#fjz0vjkgf06x4)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1139" x2="1163" y1="2548.7813" y2="2548.7813"/><polygon fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" points="406,82.9375,620,82.9375,630,93.9375,620,105.9375,406,105.9375,396,93.9375,406,82.9375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="408" y="99.0044">dnsmasq: DHCP + DNS + TFTPD</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="132.2031" y2="132.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="132.2031" y2="145.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="145.2031" y2="145.2031"/><polygon fill="#A80036" points="524,141.2031,514,145.2031,524,149.2031,520,145.2031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="520" y="127.1372">配置 IP</text><path d="M399,125.0703 L399,135.0703 A7.5,7.5 0 0 0 406.5,142.5703 L496.5,142.5703 A7.5,7.5 0 0 0 504,135.0703 L504,127.5703 L494,117.5703 L406.5,117.5703 A7.5,7.5 0 0 0 399,125.0703 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,117.5703 L494,123.8203 A3.75,3.75 0 0 0 497.75,127.5703 L504,127.5703 L494,117.5703 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="405" y="134.6372">192.168.0.11</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="174.3359" y2="174.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="174.3359" y2="187.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="187.3359" y2="187.3359"/><polygon fill="#A80036" points="524,183.3359,514,187.3359,524,191.3359,520,187.3359" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="520" y="169.27">安装 dnsmasq</text><path d="M323,167.2031 L323,177.2031 A7.5,7.5 0 0 0 330.5,184.7031 L496.5,184.7031 A7.5,7.5 0 0 0 504,177.2031 L504,169.7031 L494,159.7031 L330.5,159.7031 A7.5,7.5 0 0 0 323,167.2031 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,159.7031 L494,165.9531 A3.75,3.75 0 0 0 497.75,169.7031 L504,169.7031 L494,159.7031 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="329" y="176.77">sudo apt install dnsmasq</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="216.4688" y2="216.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="216.4688" y2="229.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="229.4688" y2="229.4688"/><polygon fill="#A80036" points="524,225.4688,514,229.4688,524,233.4688,520,229.4688" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="520" y="211.4028">创建 tftp 根路径</text><path d="M323,209.3359 L323,219.3359 A7.5,7.5 0 0 0 330.5,226.8359 L496.5,226.8359 A7.5,7.5 0 0 0 504,219.3359 L504,211.8359 L494,201.8359 L330.5,201.8359 A7.5,7.5 0 0 0 323,209.3359 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,201.8359 L494,208.0859 A3.75,3.75 0 0 0 497.75,211.8359 L504,211.8359 L494,201.8359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="329" y="218.9028">sudo mkdir -p /var/lib/tftp</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="294.9336" y2="294.9336"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="294.9336" y2="307.9336"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="307.9336" y2="307.9336"/><polygon fill="#A80036" points="524,303.9336,514,307.9336,524,311.9336,520,307.9336" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="520" y="289.8677">config dnsmasq</text><path d="M212,249.9688 L212,334.9688 A7.5,7.5 0 0 0 219.5,342.4688 L496.5,342.4688 A7.5,7.5 0 0 0 504,334.9688 L504,252.4688 L494,242.4688 L219.5,242.4688 A7.5,7.5 0 0 0 212,249.9688 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,242.4688 L494,248.7188 A3.75,3.75 0 0 0 497.75,252.4688 L504,252.4688 L494,242.4688 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="218" y="259.5356">sudo vi /etc/dnsmasq.conf</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="255" x="234" y="274.6685">conf-dir=/etc/dnsmasq.d # 去掉此行注释</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="222" y="289.8013"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="218" y="304.9341">sudo vi /etc/dnsmasq.d/pxe.conf --</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="442" y="304.9341">(注 1)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="218" y="320.0669">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="234" y="320.0669">根据 Legacy、UEFI 加载不同的文件</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="218" y="335.1997">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="234" y="335.1997">打开 tftp 并配置根路径</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="402.1641" y2="402.1641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="402.1641" y2="415.1641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="415.1641" y2="415.1641"/><polygon fill="#A80036" points="524,411.1641,514,415.1641,524,419.1641,520,415.1641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="520" y="397.0981">start dnsmasq</text><path d="M194,364.7656 L194,434.7656 A7.5,7.5 0 0 0 201.5,442.2656 L496.5,442.2656 A7.5,7.5 0 0 0 504,434.7656 L504,367.2656 L494,357.2656 L201.5,357.2656 A7.5,7.5 0 0 0 194,364.7656 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,357.2656 L494,363.5156 A3.75,3.75 0 0 0 497.75,367.2656 L504,367.2656 L494,357.2656 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="200" y="374.3325">sudo systemctl restart dnsmasq.service</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="204" y="389.4653"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="200" y="404.5981">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="273" x="216" y="404.5981">若其他 tftpd(如：tftpd-hpa）在运行，请 stop</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="200" y="419.731">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="216" y="419.731">关注防火墙</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="200" y="434.8638">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="216" y="434.8638">可用 sudo dnsmasq --no-daemon 跟踪测试</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="516.9609" y2="516.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="516.9609" y2="529.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="529.9609" y2="529.9609"/><polygon fill="#A80036" points="524,525.9609,514,529.9609,524,533.9609,520,529.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="520" y="511.895">下载并挂载 ISO —— 可选</text><path d="M113,464.4297 L113,564.4297 A7.5,7.5 0 0 0 120.5,571.9297 L496.5,571.9297 A7.5,7.5 0 0 0 504,564.4297 L504,466.9297 L494,456.9297 L120.5,456.9297 A7.5,7.5 0 0 0 113,464.4297 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,456.9297 L494,463.1797 A3.75,3.75 0 0 0 497.75,466.9297 L504,466.9297 L494,456.9297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="119" y="473.9966">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="135" y="473.9966">下载 ISO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320" x="127" y="489.1294">- http://mirrors.zte.com.cn/ubuntu-releases/20.04/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="119" y="504.2622">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="135" y="504.2622">挂载 ISO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="362" x="127" y="519.395">- sudo mount ubuntu-20.04.2.0-desktop-amd64.iso /mnt</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="119" y="534.5278">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="135" y="534.5278">链接到 tftp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="127" y="549.6606">- sudo mkdir -p /var/lib/tftp/ubuntu/20.04</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="127" y="564.7935">- sudo ln -s /mnt /var/lib/tftp/ubuntu/20.04</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="692.2891" y2="692.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="692.2891" y2="705.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="705.2891" y2="705.2891"/><polygon fill="#A80036" points="524,701.2891,514,705.2891,524,709.2891,520,705.2891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="520" y="687.2231">准备 kernel、ramdisk</text><path d="M87,594.3594 L87,785.3594 A7.5,7.5 0 0 0 94.5,792.8594 L496.5,792.8594 A7.5,7.5 0 0 0 504,785.3594 L504,596.8594 L494,586.8594 L94.5,586.8594 A7.5,7.5 0 0 0 87,594.3594 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,586.8594 L494,593.1094 A3.75,3.75 0 0 0 497.75,596.8594 L504,596.8594 L494,586.8594 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="348" x="93" y="603.9263">【方法1】-- netboot 中提取未压缩 kernel —— 有安装界面</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="93" y="619.0591">http://mirrors.zte.com.cn/ubuntu/dists/focal/main/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="93" y="634.1919">installer-amd64/current/legacy-images/netboot/netboot.tar.gz</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="93" y="649.3247">sudo tar -xzvf netboot.tar.gz -C /var/lib/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="93" y="664.4575">得到以下文件：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="93" y="679.5903">$ ls netboot/ubuntu-installer/amd64/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="93" y="694.7231">boot-screens</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="62" x="185" y="694.7231">initrd.gz</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="255" y="694.7231"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="34" x="255" y="694.7231">linux</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="293" y="694.7231">pxelinux.0  pxelinux.cfg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="97" y="709.856"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="377" x="93" y="724.9888">【方法2】-- ISO/casper 中提取压缩 kernel —— 命令行支持 nfs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="93" y="740.1216">cp /mnt/casper/{vmlinuz,initrd} /var/lib/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="97" y="755.2544"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="93" y="770.3872">- 16.04(Xenial),18.04(Bionic),20.04(Focal)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="93" y="785.52">- vmlinux(vm kernel),vmlinuz(zip vmlinux)</text><path d="M68.5,809.5859 L164,809.5859 L164,816.5859 L154,826.5859 L61,826.5859 L61,817.0859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="348.8594" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="926" x="61" y="809.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="58" x="76" y="822.6528">(1) UEFI</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="876.6172" y2="876.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="876.6172" y2="889.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="889.6172" y2="889.6172"/><polygon fill="#A80036" points="524,885.6172,514,889.6172,524,893.6172,520,889.6172" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="520" y="871.5513">准备 bootloader(grub)</text><path d="M71,839.2188 L71,909.2188 A7.5,7.5 0 0 0 78.5,916.7188 L496.5,916.7188 A7.5,7.5 0 0 0 504,909.2188 L504,841.7188 L494,831.7188 L78.5,831.7188 A7.5,7.5 0 0 0 71,839.2188 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,831.7188 L494,837.9688 A3.75,3.75 0 0 0 497.75,841.7188 L504,841.7188 L494,831.7188 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="77" y="848.7856">【方法1】-- apt 提取 signed 版 ——</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="299" y="848.7856">(注 2)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="412" x="77" y="863.9185">apt download grub-efi-amd64-signed shim-signed grub-common</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="81" y="879.0513"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="401" x="77" y="894.1841">【方法2】-- ISO/EFI 中提取 —— security boot=enable 会验证失败</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="77" y="909.3169">cp /mnt/EFI/BOOT/* /var/lib/tftp/</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="947.5156" y2="947.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="947.5156" y2="960.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="960.5156" y2="960.5156"/><polygon fill="#A80036" points="524,956.5156,514,960.5156,524,964.5156,520,960.5156" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="520" y="942.4497">配置 grub</text><path d="M224,940.3828 L224,950.3828 A7.5,7.5 0 0 0 231.5,957.8828 L496.5,957.8828 A7.5,7.5 0 0 0 504,950.3828 L504,942.8828 L494,932.8828 L231.5,932.8828 A7.5,7.5 0 0 0 224,940.3828 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,932.8828 L494,939.1328 A3.75,3.75 0 0 0 497.75,942.8828 L504,942.8828 L494,932.8828 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="230" y="949.9497">sudo vi /var/lib/tftp/grub/grub.cfg --</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="450" y="949.9497">(注 3)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="922" y1="1003.2813" y2="1003.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="922" x2="922" y1="1003.2813" y2="1016.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="881" x2="922" y1="1016.2813" y2="1016.2813"/><polygon fill="#A80036" points="891,1012.2813,881,1016.2813,891,1020.2813,887,1016.2813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="887" y="998.2153">F12 修改 BIOS</text><path d="M532,981.0156 L532,1021.0156 A7.5,7.5 0 0 0 539.5,1028.5156 L863.5,1028.5156 A7.5,7.5 0 0 0 871,1021.0156 L871,983.5156 L861,973.5156 L539.5,973.5156 A7.5,7.5 0 0 0 532,981.0156 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M861,973.5156 L861,979.7656 A3.75,3.75 0 0 0 864.75,983.5156 L871,983.5156 L861,973.5156 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="538" y="990.5825">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="554" y="990.5825">net interface uefi mode： enable</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="538" y="1005.7153">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="554" y="1005.7153">security boot：enable —— 关系 bootloader 验证</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="538" y="1020.8481">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="554" y="1020.8481">boot sequence：net first</text><polygon fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" points="865,1042.9141,895,1042.9141,905,1053.9141,895,1065.9141,865,1065.9141,855,1053.9141,865,1042.9141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="867" y="1058.981">启动</text><polygon fill="#A80036" points="524,1088.1797,514,1092.1797,524,1096.1797,520,1092.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="518" x2="879" y1="1092.1797" y2="1092.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="530" y="1087.1138">DHCP/bootp</text><polygon fill="#A80036" points="868,1117.3125,878,1121.3125,868,1125.3125,872,1121.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="874" y1="1121.3125" y2="1121.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="520" y="1116.2466">分配 IP &amp; bootloader 地址</text><polygon fill="#A80036" points="868,1146.4453,878,1150.4453,868,1154.4453,872,1150.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="874" y1="1150.4453" y2="1150.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="520" y="1145.3794">下载 bootloader(dhcp-boot &amp; grub)</text><path d="M78.5,1172.4453 L236,1172.4453 L236,1179.4453 L226,1189.4453 L71,1189.4453 L71,1179.9453 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="536.3203" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="916" x="71" y="1172.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="120" x="86" y="1185.5122">(2) BIOS(lagecy)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="1292.4414" y2="1292.4414"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="1292.4414" y2="1305.4414"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="1305.4414" y2="1305.4414"/><polygon fill="#A80036" points="524,1301.4414,514,1305.4414,524,1309.4414,520,1305.4414" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="520" y="1287.3755">准备 bootloader(pxelinux)</text><path d="M87,1202.0781 L87,1378.0781 A7.5,7.5 0 0 0 94.5,1385.5781 L496.5,1385.5781 A7.5,7.5 0 0 0 504,1378.0781 L504,1204.5781 L494,1194.5781 L94.5,1194.5781 A7.5,7.5 0 0 0 87,1202.0781 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,1194.5781 L494,1200.8281 A3.75,3.75 0 0 0 497.75,1204.5781 L504,1204.5781 L494,1194.5781 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="93" y="1211.645">【方式1】-- 在线下载(从 netboot 中提取)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="93" y="1226.7778">wget http://mirrors.zte.com.cn/ubuntu/dists/focal/main/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="93" y="1241.9106">installer-amd64/current/legacy-images/netboot/netboot.tar.gz</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="93" y="1257.0435">sudo tar -xzvf netboot.tar.gz -C /var/lib/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="97" y="1272.1763"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="93" y="1287.3091">【方式2】-- 从 syslinux 提取 ——</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="298" y="1287.3091">(注 4)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="93" y="1302.4419">sudo apt install syslinux</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="93" y="1317.5747">sudo cp /usr/lib/syslinux/vesamenu.c32 /var/lib/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="93" y="1332.7075">sudo cp /usr/lib/syslinux/pxelinux.0 /var/lib/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="386" x="93" y="1347.8403">sudo cp /usr/lib/syslinux/modules/bios/ldlinux.c32 /var/lib/tftp/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="97" y="1362.9731"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="93" y="1378.106">【方式3】-- 从 ISO 提取 ——</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138" x="270" y="1378.106">后来很多 ISO 都没有了</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="1437.5039" y2="1437.5039"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="1437.5039" y2="1450.5039"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="1450.5039" y2="1450.5039"/><polygon fill="#A80036" points="524,1446.5039,514,1450.5039,524,1454.5039,520,1450.5039" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="520" y="1432.438">配置 pxelinux --</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="620" y="1432.438">(注 5)</text><path d="M81,1407.6719 L81,1462.6719 A7.5,7.5 0 0 0 88.5,1470.1719 L496.5,1470.1719 A7.5,7.5 0 0 0 504,1462.6719 L504,1410.1719 L494,1400.1719 L88.5,1400.1719 A7.5,7.5 0 0 0 81,1407.6719 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,1400.1719 L494,1406.4219 A3.75,3.75 0 0 0 497.75,1410.1719 L504,1410.1719 L494,1400.1719 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="87" y="1417.2388">新版:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="402" x="87" y="1432.3716">sudo vi /var/lib/tftp/ubuntu-installer/amd64/boot-screens/txt.cfg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="87" y="1447.5044">旧版:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="87" y="1462.6372">sudo vi /var/lib/tftp/pxelinux.cfg/default</text><path d="M841,1492.2031 L841,1502.2031 A7.5,7.5 0 0 0 848.5,1509.7031 L907.5,1509.7031 A7.5,7.5 0 0 0 915,1502.2031 L915,1494.7031 L905,1484.7031 L848.5,1484.7031 A7.5,7.5 0 0 0 841,1492.2031 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M905,1484.7031 L905,1490.9531 A3.75,3.75 0 0 0 908.75,1494.7031 L915,1494.7031 L905,1484.7031 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="847" y="1501.77">（注 6）</text><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="922" y1="1553.6016" y2="1553.6016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="922" x2="922" y1="1553.6016" y2="1566.6016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="881" x2="922" y1="1566.6016" y2="1566.6016"/><polygon fill="#A80036" points="891,1562.6016,881,1566.6016,891,1570.6016,887,1566.6016" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="887" y="1548.5356">F12 修改 BIOS</text><path d="M625,1531.3359 L625,1571.3359 A7.5,7.5 0 0 0 632.5,1578.8359 L863.5,1578.8359 A7.5,7.5 0 0 0 871,1571.3359 L871,1533.8359 L861,1523.8359 L632.5,1523.8359 A7.5,7.5 0 0 0 625,1531.3359 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M861,1523.8359 L861,1530.0859 A3.75,3.75 0 0 0 864.75,1533.8359 L871,1533.8359 L861,1523.8359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="631" y="1540.9028">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="647" y="1540.9028">net interface pxe mode： enable</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="631" y="1556.0356">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="647" y="1556.0356">security boot：disable</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="631" y="1571.1685">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="647" y="1571.1685">boot sequence：net first</text><polygon fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" points="865,1593.2344,895,1593.2344,905,1604.2344,895,1616.2344,865,1616.2344,855,1604.2344,865,1593.2344" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="867" y="1609.3013">启动</text><polygon fill="#A80036" points="524,1638.5,514,1642.5,524,1646.5,520,1642.5" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="518" x2="879" y1="1642.5" y2="1642.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="530" y="1637.4341">DHCP/bootp</text><polygon fill="#A80036" points="868,1667.6328,878,1671.6328,868,1675.6328,872,1671.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="874" y1="1671.6328" y2="1671.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="520" y="1666.5669">分配 IP &amp; bootloader 地址</text><polygon fill="#A80036" points="868,1696.7656,878,1700.7656,868,1704.7656,872,1700.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="874" y1="1700.7656" y2="1700.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="520" y="1695.6997">下载 bootloader(pxelinux)</text><polygon fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" points="843,1720.7656,916,1720.7656,926,1731.7656,916,1743.7656,843,1743.7656,833,1731.7656,843,1720.7656" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="845" y="1736.8325">bootloader</text><polygon fill="#A80036" points="868,1766.0313,878,1770.0313,868,1774.0313,872,1770.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="874" y1="1770.0313" y2="1770.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="343" x="520" y="1764.9653">下载 configuration(包含 kernel,ramdisk,kernel CLI 路径)</text><polygon fill="#A80036" points="868,1795.1641,878,1799.1641,868,1803.1641,872,1799.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="874" y1="1799.1641" y2="1799.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="520" y="1794.0981">下载 kernel,ramdisk, kernel CLI</text><polygon fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" points="831,1812.1641,929,1812.1641,939,1823.1641,929,1835.1641,831,1835.1641,821,1823.1641,831,1812.1641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="833" y="1828.231">ramdisk,kernel</text><path d="M17.5,1847.2969 L317,1847.2969 L317,1854.2969 L307,1864.2969 L10,1864.2969 L10,1854.7969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="161.0625" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="902.5" x="10" y="1847.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="262" x="25" y="1860.3638">(1) NFS install by ISO/casper kernel</text><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="555" y1="1921.8945" y2="1921.8945"/><line style="stroke:#A80036;stroke-width:1.0;" x1="555" x2="555" y1="1921.8945" y2="1934.8945"/><line style="stroke:#A80036;stroke-width:1.0;" x1="514" x2="555" y1="1934.8945" y2="1934.8945"/><polygon fill="#A80036" points="524,1930.8945,514,1934.8945,524,1938.8945,520,1934.8945" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="520" y="1916.8286">配置 NFS server</text><path d="M20,1876.9297 L20,1961.9297 A7.5,7.5 0 0 0 27.5,1969.4297 L496.5,1969.4297 A7.5,7.5 0 0 0 504,1961.9297 L504,1879.4297 L494,1869.4297 L27.5,1869.4297 A7.5,7.5 0 0 0 20,1876.9297 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M494,1869.4297 L494,1875.6797 A3.75,3.75 0 0 0 497.75,1879.4297 L504,1879.4297 L494,1869.4297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="26" y="1886.4966">sudo apt install nfs-kernel-server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="26" y="1901.6294">sudo vi /etc/exports</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="447" x="42" y="1916.7622">/var/lib/tftpboot/ubuntu *(ro,async,no_root_squash,no_subtree_check)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="26" y="1931.895">sudo exportfs -a # 全部挂载或者全部卸</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="26" y="1947.0278">sudo exportfs -v # 显示共享目</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="26" y="1962.1606">sudo /etc/init.d/nfs-kernel-server start</text><polygon fill="#A80036" points="868,1996.3594,878,2000.3594,868,2004.3594,872,2000.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="513" x2="874" y1="2000.3594" y2="2000.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="520" y="1995.2935">ISO</text><path d="M735.5,2022.3594 L1016,2022.3594 L1016,2029.3594 L1006,2039.3594 L728,2039.3594 L728,2029.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="424.9922" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:2.0;" width="510" x="728" y="2022.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="243" x="743" y="2035.4263">(2) http install by netboot kernel</text><path d="M749,2051.9922 L749,2076.9922 A7.5,7.5 0 0 0 756.5,2084.4922 L998.5,2084.4922 A7.5,7.5 0 0 0 1006,2076.9922 L1006,2054.4922 L996,2044.4922 L756.5,2044.4922 A7.5,7.5 0 0 0 749,2051.9922 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M996,2044.4922 L996,2050.7422 A3.75,3.75 0 0 0 999.75,2054.4922 L1006,2054.4922 L996,2044.4922 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="755" y="2061.5591">netboot/ubuntu-installer/amd64/linux</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="755" y="2076.6919">图形界面</text><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="922" y1="2114.8906" y2="2114.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="922" x2="922" y1="2114.8906" y2="2127.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="881" x2="922" y1="2127.8906" y2="2127.8906"/><polygon fill="#A80036" points="891,2123.8906,881,2127.8906,891,2131.8906,887,2127.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="887" y="2109.8247">配置语言、键盘、时间等</text><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="922" y1="2163.0898" y2="2163.0898"/><line style="stroke:#A80036;stroke-width:1.0;" x1="922" x2="922" y1="2163.0898" y2="2176.0898"/><line style="stroke:#A80036;stroke-width:1.0;" x1="881" x2="922" y1="2176.0898" y2="2176.0898"/><polygon fill="#A80036" points="891,2172.0898,881,2176.0898,891,2180.0898,887,2176.0898" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="887" y="2158.0239">网卡转接大网，配置大网 IP</text><path d="M738,2148.3906 L738,2173.3906 A7.5,7.5 0 0 0 745.5,2180.8906 L863.5,2180.8906 A7.5,7.5 0 0 0 871,2173.3906 L871,2150.8906 L861,2140.8906 L745.5,2140.8906 A7.5,7.5 0 0 0 738,2148.3906 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M861,2140.8906 L861,2147.1406 A3.75,3.75 0 0 0 864.75,2150.8906 L871,2150.8906 L861,2140.8906 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="744" y="2157.9575">10.227.14.235/23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="744" y="2173.0903">10.227.14.1</text><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="922" y1="2224.9219" y2="2224.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="922" x2="922" y1="2224.9219" y2="2237.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="881" x2="922" y1="2237.9219" y2="2237.9219"/><polygon fill="#A80036" points="891,2233.9219,881,2237.9219,891,2241.9219,887,2237.9219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="887" y="2219.856">配置 Ubuntu Archive Mirror</text><path d="M746,2202.6563 L746,2242.6563 A7.5,7.5 0 0 0 753.5,2250.1563 L863.5,2250.1563 A7.5,7.5 0 0 0 871,2242.6563 L871,2205.1563 L861,2195.1563 L753.5,2195.1563 A7.5,7.5 0 0 0 746,2202.6563 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M861,2195.1563 L861,2201.4063 A3.75,3.75 0 0 0 864.75,2205.1563 L871,2205.1563 L861,2195.1563 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="752" y="2212.2231">配置 mirror：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="752" y="2227.356">10.31.194.13:80</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="752" y="2242.4888">/ubuntu/</text><polygon fill="#A80036" points="891,2276.6875,881,2280.6875,891,2284.6875,887,2280.6875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="885" x2="1150" y1="2280.6875" y2="2280.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="897" y="2275.6216">dists/focal/main/binary-amd64/Release</text><polygon fill="#A80036" points="891,2305.8203,881,2309.8203,891,2313.8203,887,2309.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="885" x2="1150" y1="2309.8203" y2="2309.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="897" y="2304.7544">dists/focal/Release</text><polygon fill="#A80036" points="891,2334.9531,881,2338.9531,891,2342.9531,887,2338.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="885" x2="1150" y1="2338.9531" y2="2338.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="897" y="2333.8872">dists/focal/Release.gpg</text><polygon fill="#A80036" points="891,2364.0859,881,2368.0859,891,2372.0859,887,2368.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="885" x2="1150" y1="2368.0859" y2="2368.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="897" y="2363.02">基础包</text><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="922" y1="2397.2188" y2="2397.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="922" x2="922" y1="2397.2188" y2="2410.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="881" x2="922" y1="2410.2188" y2="2410.2188"/><polygon fill="#A80036" points="891,2406.2188,881,2410.2188,891,2414.2188,887,2410.2188" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="887" y="2392.1528">配置账号</text><polygon fill="#A80036" points="891,2435.3516,881,2439.3516,891,2443.3516,887,2439.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="885" x2="1150" y1="2439.3516" y2="2439.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="897" y="2434.2856">其他包</text><path d="M826,2466.8516 L826,2476.8516 A7.5,7.5 0 0 0 833.5,2484.3516 L922.5,2484.3516 A7.5,7.5 0 0 0 930,2476.8516 L930,2469.3516 L920,2459.3516 L833.5,2459.3516 A7.5,7.5 0 0 0 826,2466.8516 " fill="#FBFB77" filter="url(#fjz0vjkgf06x4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M920,2459.3516 L920,2465.6016 A3.75,3.75 0 0 0 923.75,2469.3516 L930,2469.3516 L920,2459.3516 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="832" y="2476.4185">善后</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="862" y="2476.4185">（注 7）</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="467" x="781" y="14.2822">Netbooting the server installer on amd64(https://ubuntu.com/server/docs/install/netboot-amd64)</text><!--MD5=[fae2b30e23bcb806320fbc4330ce073c]
@startuml
skinparam roundCorner 15

header:Netbooting the server installer on amd64(https://ubuntu.com/server/docs/install/netboot-amd64)

entity Server as s
entity Client as c
entity "Ubuntu Archive Mirror" as u

hnote over s:dnsmasq: DHCP + DNS + TFTPD

s->s:配置 IP
note left
192.168.0.11
end note

s->s:安装 dnsmasq
note left
sudo apt install dnsmasq
end note

s->s:创建 tftp 根路径
note left
sudo mkdir -p /var/lib/tftp
end note

s -> s: config dnsmasq
note left
sudo vi /etc/dnsmasq.conf
    conf-dir=/etc/dnsmasq.d # 去掉此行注释

sudo vi /etc/dnsmasq.d/pxe.conf - - **(注 1)**
# 根据 Legacy、UEFI 加载不同的文件
# 打开 tftp 并配置根路径
end note

s -> s: start dnsmasq
note left
sudo systemctl restart dnsmasq.service

# 若其他 tftpd(如：tftpd-hpa）在运行，请 stop
# 关注防火墙
# 可用 sudo dnsmasq - -no-daemon 跟踪测试
end note

s->s:下载并挂载 ISO —— 可选
note left
# 下载 ISO
  - http://mirrors.zte.com.cn/ubuntu-releases/20.04/
# 挂载 ISO
  - sudo mount ubuntu-20.04.2.0-desktop-amd64.iso /mnt
# 链接到 tftp
  - sudo mkdir -p /var/lib/tftp/ubuntu/20.04
  - sudo ln -s /mnt /var/lib/tftp/ubuntu/20.04
end note

s->s:准备 kernel、ramdisk
note left
【方法1】- - netboot 中提取未压缩 kernel —— 有安装界面
http://mirrors.zte.com.cn/ubuntu/dists/focal/main/
installer-amd64/current/legacy-images/netboot/netboot.tar.gz
sudo tar -xzvf netboot.tar.gz -C /var/lib/tftp/
得到以下文件：
$ ls netboot/ubuntu-installer/amd64/
boot-screens  **initrd.gz**  **linux** pxelinux.0  pxelinux.cfg

【方法2】- - ISO/casper 中提取压缩 kernel —— 命令行支持 nfs
cp /mnt/casper/{vmlinuz,initrd} /var/lib/tftp/

- 16.04(Xenial),18.04(Bionic),20.04(Focal)
- vmlinux(vm kernel),vmlinuz(zip vmlinux)
end note





group (1) UEFI

s->s:准备 bootloader(grub)
note left
【方法1】- - apt 提取 signed 版 —— **(注 2)**
apt download grub-efi-amd64-signed shim-signed grub-common

【方法2】- - ISO/EFI 中提取 —— security boot=enable 会验证失败
cp /mnt/EFI/BOOT/* /var/lib/tftp/
end note

s->s:配置 grub
note left
sudo vi /var/lib/tftp/grub/grub.cfg - -**(注 3)**
end note

c->c:F12 修改 BIOS
note left
# net interface uefi mode： enable
# security boot：enable —— 关系 bootloader 验证
# boot sequence：net first
end note

hnote over c:启动
c->s:DHCP/bootp
s->c:分配 IP & bootloader 地址
s->c:下载 bootloader(dhcp-boot & grub)
end





group (2) BIOS(lagecy)

s->s:准备 bootloader(pxelinux)
note left
【方式1】- - 在线下载(从 netboot 中提取)
wget http://mirrors.zte.com.cn/ubuntu/dists/focal/main/
installer-amd64/current/legacy-images/netboot/netboot.tar.gz
sudo tar -xzvf netboot.tar.gz -C /var/lib/tftp/

【方式2】- - 从 syslinux 提取 —— **(注 4)**
sudo apt install syslinux
sudo cp /usr/lib/syslinux/vesamenu.c32 /var/lib/tftp/
sudo cp /usr/lib/syslinux/pxelinux.0 /var/lib/tftp/
sudo cp /usr/lib/syslinux/modules/bios/ldlinux.c32 /var/lib/tftp/

【方式3】- - 从 ISO 提取 —— **后来很多 ISO 都没有了**
end note

s->s:配置 pxelinux - - **(注 5)**
note left
新版:
sudo vi /var/lib/tftp/ubuntu-installer/amd64/boot-screens/txt.cfg
旧版:
sudo vi /var/lib/tftp/pxelinux.cfg/default
end note

note over c:**（注 6）**
c->c:F12 修改 BIOS
note left
# net interface pxe mode： enable
# security boot：disable
# boot sequence：net first
end note

hnote over c:启动
c->s:DHCP/bootp
s->c:分配 IP & bootloader 地址

s->c:下载 bootloader(pxelinux)
end




hnote over c:bootloader
s->c:下载 configuration(包含 kernel,ramdisk,kernel CLI 路径)
s->c:下载 kernel,ramdisk, kernel CLI
hnote over c:ramdisk,kernel
group (1) NFS install by ISO/casper kernel

s->s:配置 NFS server
note left
sudo apt install nfs-kernel-server
sudo vi /etc/exports
    /var/lib/tftpboot/ubuntu *(ro,async,no_root_squash,no_subtree_check)
sudo exportfs -a # 全部挂载或者全部卸
sudo exportfs -v # 显示共享目
sudo /etc/init.d/nfs-kernel-server start
end note
s -> c : ISO
end
group (2) http install by netboot kernel
note over c:netboot/ubuntu-installer/amd64/linux\n图形界面
c->c:配置语言、键盘、时间等
c->c:网卡转接大网，配置大网 IP
note left
10.227.14.235/23
10.227.14.1
end note
c->c:配置 Ubuntu Archive Mirror
note left
配置 mirror：
10.31.194.13:80
/ubuntu/
end note
u->c:dists/focal/main/binary-amd64/Release
u->c:dists/focal/Release
u->c:dists/focal/Release.gpg
u->c:基础包
c->c:配置账号
u->c:其他包
end

note over c:善后 **（注 7）**
@enduml

PlantUML version 1.2021.4(Sun Apr 04 08:49:39 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>